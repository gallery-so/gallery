language: 'javascript'

fileGroups:
  tests:
    - 'tests/**/*'
    - '**/*.test.ts*'
  lint:
    - '**/*.*{ts,js,tsx,jsx,cjs,mjs}'
  source:
    - 'src/**/*.{ts,js,tsx,jsx}'

tasks:
  relay-watch:
    command: yarn relay-compiler --watch relay.config.js
    local: true

  relay-codegen:
    command: yarn relay-compiler --repersist ../../relay.config.js
    inputs:
      - '@group(source)'

  codegen-watch:
    command: yarn relay-compiler --repersist --watch ../../relay.config.js
    local: true

  ios-prebuild:
    command: yarn expo prebuild -p ios
    local: true

  ios-raw:
    command: yarn expo run:ios
    local: true

  ios-device-raw:
    command: yarn expo run:ios --device
    local: true

  ios-device:
    command: noop
    local: true
    deps:
      - '~:ios-device-raw'
      - '~:relay-watch'

  ios:
    command: noop
    local: true
    deps:
      - ~:ios-raw
      - ~:relay-watch

  android-prebuild:
    command: yarn expo prebuild -p android
    local: true

  android-raw:
    command: yarn expo run:android
    local: true

  android-device-raw:
    command: yarn expo run:android --device
    local: true

  android-device:
    command: noop
    local: true
    deps:
      - '~:android-device-raw'
      - '~:relay-watch'

  android:
    command: noop
    local: true
    deps:
      - ~:android-raw
      - ~:relay-watch

  ios-build:
    command: yarn eas build -p ios --local
    env:
      EAS_LOCAL_BUILD_SKIP_CLEANUP: '1'
    local: true

  # Inherited from root task
  typecheck:
    deps:
      - '~:relay-codegen'
    command: yarn tsc

  version-bump:
    command: yarn run version-bump
